<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fase 2 ‚Äî Geladeira</title>
<!-- html5-qrcode -->
<script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
<style>
  :root{--p1:#6b2fb6;--p2:#9b6ef4}
  *{box-sizing:border-box;margin:0;padding:0}
  body{min-height:100vh;display:flex;align-items:center;justify-content:center;font-family:Poppins;background:linear-gradient(135deg,#f7f2ff,#f0e8ff);padding:18px;color:#270a3a}
  .card{width:100%;max-width:520px;padding:20px;border-radius:14px;background:rgba(255,255,255,0.06);backdrop-filter:blur(6px);text-align:center;box-shadow:0 10px 30px rgba(107,47,182,0.12)}
  h1{color:var(--p1);margin-bottom:8px}
  p.lead{font-weight:700;margin-bottom:12px}
  .qr-box{width:100%;height:320px;border-radius:12px;background:rgba(255,255,255,0.08);display:flex;align-items:center;justify-content:center;overflow:hidden;margin-bottom:10px}
  .hint{background:linear-gradient(90deg,#f3e8ff,#efe6fb);padding:10px;border-radius:10px;margin-bottom:10px;font-weight:700;color:#3a0c4a}
  .controls{display:flex;gap:10px;justify-content:center;margin-bottom:8px}
  button{background:linear-gradient(180deg,var(--p2),var(--p1));color:#fff;border:none;padding:10px 16px;border-radius:10px;cursor:pointer;font-weight:800}
  button.secondary{background:transparent;border:1px solid rgba(39,10,58,0.06);color:var(--p1)}
  .manual{margin-top:8px;display:flex;gap:8px;justify-content:center}
  input{padding:10px;border-radius:8px;border:1px solid rgba(39,10,58,0.06);width:60%}
  /* modal */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:none;align-items:center;justify-content:center;z-index:99}
  .modal .box{background:#fff;padding:20px;border-radius:12px;text-align:center;max-width:420px;width:90%}
  .box h2{color:var(--p1);margin-bottom:8px}
</style>
</head>
<body>
  <div class="card">
    <h1>Fase 2</h1>
    <p class="lead">Escaneie o QR Code para liberar a pr√≥xima pista</p>

    <div class="qr-box" id="qr-region">
      <!-- v√≠deo/c√¢mera aparece aqui -->
    </div>

    <div class="hint" id="hint">Primeira miss√£o: procure o QR Code onde o frio √© o rei (geladeira).</div>

    <div class="controls">
      <button id="start-btn">üì∑ Escanear</button>
      <button id="stop-btn" class="secondary" disabled>‚èπ Parar</button>
    </div>

    <div class="manual">
      <input id="manual-input" placeholder="Digite o c√≥digo (se precisar)" />
      <button id="manual-ok" class="secondary">Confirmar</button>
    </div>
    <div style="margin-top:10px;font-weight:700;color:rgba(39,10,58,0.7)">Fase 2 de 10</div>
  </div>

  <!-- modal -->
  <div id="modal" class="modal">
    <div class="box">
      <h2>Voc√™ est√° indo bem!</h2>
      <p>Continue, amor ‚Äî j√° falta pouco üíú</p>
      <div style="margin-top:12px">
        <button id="modal-next">Pr√≥xima</button>
        <button id="modal-close" class="secondary">Fechar</button>
      </div>
    </div>
  </div>

<script>
/* Fase 2 ‚Äî c√≥digo esperado: "fase2" */
const expected = 'fase2';
let scanner = null;
let scanning = false;
const startBtn = document.getElementById('start-btn');
const stopBtn = document.getElementById('stop-btn');
const qrRegionId = 'qr-region';
const modal = document.getElementById('modal');
const modalNext = document.getElementById('modal-next');
const modalClose = document.getElementById('modal-close');
const manualInput = document.getElementById('manual-input');
const manualOk = document.getElementById('manual-ok');

function showModal() { modal.style.display='flex'; }
function hideModal(){ modal.style.display='none'; }

startBtn.addEventListener('click', async () => {
  if (scanning) return;
  scanner = new Html5Qrcode(qrRegionId);
  try {
    const devices = await Html5Qrcode.getCameras();
    if (!devices || devices.length===0) { alert('Nenhuma c√¢mera detectada'); return; }
    const cam = devices.find(d=>/back|rear|tr√°s/i.test(d.label)) || devices[0];
    await scanner.start(cam.id, { fps: 10, qrbox: 250 },
      (decoded) => {
        const text = String(decoded).trim().toLowerCase();
        if (text === expected) {
          stopScanner();
          showModal();
        } else {
          // se quiser, mostrar feedback breve
          console.log('QR lido (n√£o esperado):', text);
        }
      },
      (err)=>{ /* ignore small errors */ }
    );
    scanning = true;
    startBtn.disabled = true;
    stopBtn.disabled = false;
  } catch(err) {
    console.error(err);
    alert('Erro ao acessar a c√¢mera. Verifique permiss√µes e HTTPS.');
  }
});

stopBtn.addEventListener('click', stopScanner);

function stopScanner(){
  if (!scanning || !scanner) return;
  scanner.stop().then(()=>{
    scanner.clear();
    scanning = false;
    startBtn.disabled = false;
    stopBtn.disabled = true;
  }).catch(e=>{console.warn('stop error',e)});
}

modalClose.addEventListener('click', hideModal);
modalNext.addEventListener('click', ()=> location.href='fase3.html');

manualOk.addEventListener('click', ()=>{
  const val = (manualInput.value||'').trim().toLowerCase();
  if (!val) return alert('Digite algo');
  if (val === expected) showModal();
  else alert('C√≥digo incorreto, tenta de novo üíú');
});
</script>
</body>
</html>
